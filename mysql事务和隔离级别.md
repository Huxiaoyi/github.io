# mysql事务
mysql事务主要用于处理操作量大、复杂度高、安全性要求很高的数据；比如员工离职时需要清理员工所有相关的个人、部门等信息，
比如银行系统对支付、转账安全性要求很高等。

## 1. mysql事务相关概念
* 事务用于维护数据库的完整性，保证批量sql操作要么全部执行，要么全部不执行
* MyISAM不支持事务，Innodb支持事务
* 事务用来管理insert,update,delete类型语句
* 事务4个特性：
<br/>①. 原子性：一个事务中所有操作，要么全部执行，要么全部不执行
<br/>②. 一致性：事务开始前和结束后，数据库的完整性约束没有被破坏；比如A向B转账，不可能A扣了钱，B却没收到
<br/>③. 隔离性：事务进行过程中，其他事务看不到此事务的任何效果
事务隔离分为四个级别：读未提交、读提交、可重复读和串行化
<br/>④. 持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失

## 2. 事务隔离级别
事务隔离级别分为四个等级，从上到下依次增强：
* 读未提交：可以读取到尚未提交的事务
* 读提交：在一个事务执行过程中，读不到另一个进行中的事务A，但在事务A结束后可以读取到，不符合隔离性
* 可重复读：事务之间各自独立，相互不影响，该隔离级别最常用
* 串行化：所有语句按先后之分，一句一句执行，效率太低

## 3. 事务的并发问题
* 脏读：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据
* 不可重复读：事务B在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时结果不一致
* 幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。

小结：不可重复读和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除；
解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表

## 4. 事务隔离级别带来的并发问题
|事务隔离级别      | 脏读 | 不可重复读 | 幻读|
|:-----------------|:----:|:----------:|-----|
|read uncommitted  |  是  |      是	   |  是 |
|read committed    |  否  |      是	   |  是 |
|repeatable read   |  否  |      否	   |  是 |
|serializable	   |  否  |      否	   |  否 |
```
修改配置文件设置数据库隔离级别
[mysqld]
transaction-isolation = [ READ-UNCOMMITTED | READ-COMMITTED | REPEATABLE-READ | SERIALIZABLE ]
```
 

















